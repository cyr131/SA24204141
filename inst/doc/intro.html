<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Yiran Chen" />

<meta name="date" content="2024-12-07" />

<title>Empirical likelihood alternatives for generalized estimating equations</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Empirical likelihood alternatives for
generalized estimating equations</h1>
<h4 class="author">Yiran Chen</h4>
<h4 class="date">2024-12-07</h4>



<div id="summary" class="section level2">
<h2>Summary</h2>
<p>The R package <em>SA24204141</em> is used for estimating regression
coefficients for longitudinal data with a working correlation structure
using generalized estimating equations (GEE).The R package provides two
functions that solve the above problem: <em>GEE</em> and
<em>GEE_EL</em>.</p>
<p>The <em>GEE</em> function is the classical method of solving GEE to
obtain parameter estimates.This function requires the input of a
specifically known working correlation matrix R.</p>
<p>It has the advantage of running at a faster rate and can be more
consistently maintained to produce smaller estimation errors. However,
it has the disadvantage that the working correlation matrix R needs to
be specified, and R is often unknown in practice.In addition , the
method of estimating the equations is not conducive to subsequent model
selection.</p>
<p>The <em>GEE_EL</em> function is an alternative approach in the
empirical likelihood framework, which estimates the regression
coefficients for longitudinal data by means of a great empirical
likelihood ratio, a method that is my innovation.</p>
<p>It has the advantage that it does not need to specify a specific R,
only the type to which the R belongs is given, and the final R and the
parameter of interest are estimated by iteration. This likelihood-based
approach facilitates subsequent model selection, thus improving the
efficiency of parameter estimation. However, it has the disadvantage
that the computer running rate is lower than that of the GEE function
due to the need to solve the two-layer optimization problem.</p>
<p>In addition to the two main functions mentioned above, there are
<em>exchCpp, ar1Cpp, statCpp,</em>(they are Rcpp functions) and
<em>logit</em> functions that are used to assist the two main
functions.</p>
</div>
<div id="model" class="section level2">
<h2>Model</h2>
<p>For longitudinal data, let <span class="math inline">\(y_{it}\)</span> be the response of interest and
<span class="math inline">\(x_{it}\)</span> be a p-dimensional vector of
covariate information of subject i at time t, where i = 1, … , n and t =
1, … , T. We consider a generalized linear model for <span class="math inline">\(y_{it}\)</span>, given by:</p>
<p><span class="math display">\[f(y_{it}|{x}_{it};{\beta}_{i},\phi) =
exp
[\{y_{it}{\theta}_{it}-a({\theta}_{it})+b(y_{it})\}/{\phi}]\]</span></p>
<p>where a(.) and b(.) are known functions, <span class="math inline">\(\theta_{it}=u(x_{it}^{T}\beta_{i})\)</span> , link
function u(.) a known monotone function, <span class="math inline">\(\beta_{i}\)</span> is the regression
parameter,<span class="math inline">\(\phi\)</span> is a known scale
parameter common to all subjects.</p>
<div id="gee-method" class="section level3">
<h3>GEE method</h3>
<p>A <span class="math inline">\(t_i \times t_i\)</span> working
correlation matrix <span class="math inline">\(R(\alpha),
\alpha=\left(\alpha_1, \ldots, \alpha_s\right)^T\)</span>, is assumed
for <span class="math inline">\(Y_i\)</span>, and the corresponding
working covariance matrix is <span class="math display">\[
V_i(\beta, \alpha, \phi)=A_i^{1 / 2}(\beta, \phi) R(\alpha) A_i^{1 /
2}(\beta, \phi),
\]</span> where <span class="math inline">\(A_i(\beta, \phi)\)</span> is
a diagonal matrix with <span class="math inline">\(\operatorname{var}\left(Y_{i j}\right)=\phi
v\left(\mu_{i j}\right), j=1, \ldots, t_i\)</span>, along the diagonal.
<span class="math inline">\(V_i=\operatorname{var}\left(Y_i\right)\)</span> if
<span class="math inline">\(R(\alpha)\)</span> is chosen correctly. The
generalized estimating equation for <span class="math inline">\(\beta\)</span> is defined as <span class="math display">\[
\sum_{i=1}^n\left(\frac{\partial \mu_i}{\partial \beta^T}\right)^T
V_i^{-1}(\beta, \alpha, \phi)\left(Y_i-\mu_i\right)=0
\]</span></p>
</div>
<div id="gee_el-method" class="section level3">
<h3>GEE_EL method</h3>
<p>The empirical likelihood ratio (ELR) is</p>
<p><span class="math display">\[\mathcal{R}(\theta)=\rm{\sup}\{\displaystyle\prod_{i=1}^n
n w_{i}:w_{i}\ge0,\displaystyle\sum_{i=1}^n
w_{i}=1,\displaystyle\sum_{i=1}^n
w_{i}g(X_{i},\theta)=0\}\quad(1)\]</span></p>
<p>The maximum empirical likelihood estimator (MELE) of <span class="math inline">\(\theta_0\)</span> is</p>
<p><span class="math display">\[\hat{\theta}=\mathop{\arg\max}\limits_{\theta}\mathcal{R}(\theta)\quad(2)\]</span>
Applying the above MELE to the parameter estimation of longitudinal
data. Within-subject correlation (R) is considered:</p>
<p><span class="math display">\[g((Y_{i},X_{i}),\beta;R)=(\displaystyle\frac{\partial{\mu}_{i}}{\partial{\beta}^{T}})^{T}A_{i}^{-1/2}R^{-1}(\hat{\alpha}(\beta))A_{i}^{-1/2}(Y_{i}-{\mu}_{i})\quad(3)\]</span></p>
<p>The <span class="math inline">\(\hat{\alpha}(\beta)\)</span> is the
MOM estimator of <span class="math inline">\(\alpha\)</span> given <span class="math inline">\(\beta\)</span> and R, as shown in the Table1
(<span class="math inline">\(e_{ij}\)</span> is the Pearson
residuals)</p>
<p>In (1), <span class="math inline">\(g(X_i,\theta)\)</span> replaced
by <span class="math inline">\(g((Y_{i},X_{i}),\beta;R)\)</span>, <span class="math inline">\(\theta\)</span> replaced by <span class="math inline">\(\beta\)</span>,then the MELE for <span class="math inline">\(\beta\)</span> is <span class="math inline">\(\hat{\beta}_{E}=\mathop{\arg\max}\limits_{\beta
\in {\mathbb{R}}^p}\mathcal{R}(\beta)\)</span> and <span class="math inline">\(\hat{\alpha}_E\)</span> is the MOM estimator of
<span class="math inline">\(\alpha\)</span> given <span class="math inline">\(\hat{\beta}_{E}\)</span></p>
</div>
<div id="data-generation" class="section level3">
<h3>data generation</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(bindata)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(SA24204141)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;SA24204141&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:boot&#39;:
## 
##     logit</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>  <span class="do">## settings</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  TT <span class="ot">&lt;-</span> <span class="dv">10</span>   <span class="co"># 10 or 20</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">100</span>    <span class="co"># 180 or 270</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  ID <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  N <span class="ot">&lt;-</span> n<span class="sc">*</span>TT</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="do">## covariates</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">3</span>   <span class="co"># number of covariates</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  CC <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  zz <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n<span class="sc">*</span>TT, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), CC)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(zz[,<span class="dv">1</span>], n, TT)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(zz[,<span class="dv">2</span>], n, TT)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  X0 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(n, TT, p))</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  X0[,,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  X0[,,<span class="dv">2</span>] <span class="ot">&lt;-</span> x1</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  X0[,,<span class="dv">3</span>] <span class="ot">&lt;-</span> x2</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>  <span class="do">## regression coefficients</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>  Beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="dv">1</span>)   <span class="co"># true regression coefficients</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>  tMu <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, n, TT)</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    tMu[i,] <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(X0[i,,]<span class="sc">%*%</span>Beta)</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>  }</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>  Prob <span class="ot">&lt;-</span> <span class="fu">logit</span>(tMu)</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>  <span class="do">## true correlation structure (equi-correlation)</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>  tR <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fl">0.5</span>, TT, TT)</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>  <span class="fu">diag</span>(tR) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>  <span class="do">## data generation</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>  Y0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, n, TT)</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>    Y0[i,] <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">rmvbin</span>(<span class="dv">1</span>, <span class="at">margprob=</span>Prob[i,], <span class="at">sigma=</span>tR))</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>  }</span></code></pre></div>
</div>
</div>
<div id="my-function" class="section level2">
<h2>My function</h2>
<div id="gee" class="section level3">
<h3>GEE</h3>
<p>Estimates of regression coefficients are obtained by solving
generalized estimating equations</p>
<p>Input:</p>
<p>-YY Response Variables (Matrix) -XX Independent variables
(3-dimensional arrays) -RR Designated working correlation matrix
(Matrix) -init.beta initial value of iteration (vector) -maxit Maximum
number of iteration (int)</p>
<p>Output:final coefficient estimates</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="cf">function</span>(YY, XX, RR, <span class="at">init.beta=</span><span class="cn">NULL</span>, <span class="at">maxit=</span><span class="dv">100</span>){</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="co"># 赋值参数</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  th <span class="ot">&lt;-</span> <span class="fl">0.0001</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  ep <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">5</span>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">dim</span>(YY)[<span class="dv">1</span>]</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(YY)[<span class="dv">2</span>]</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">dim</span>(XX)[<span class="dv">3</span>]</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(init.beta)){ hB <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, p) }</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="cf">else</span>{ hB <span class="ot">&lt;-</span> init.beta }</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="do">## GEE求解</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="co"># Iteration次数</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>maxit){</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    hB0 <span class="ot">&lt;-</span> hB</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>    mat1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>    mat2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="co"># 遍历n个subjects</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>      Mu <span class="ot">&lt;-</span> <span class="fu">logit</span>(<span class="fu">as.vector</span>(XX[i,,]<span class="sc">%*%</span>hB))</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>      S <span class="ot">&lt;-</span> YY[i,]<span class="sc">-</span>Mu</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>      vv <span class="ot">&lt;-</span> Mu<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>Mu)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>      vv[vv<span class="sc">&lt;</span>th] <span class="ot">&lt;-</span> th</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="fu">diag</span>(vv)</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>      V <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(A)<span class="sc">%*%</span>RR<span class="sc">%*%</span><span class="fu">sqrt</span>(A) <span class="sc">+</span> th<span class="sc">*</span><span class="fu">diag</span>(TT)</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>      D <span class="ot">&lt;-</span> A<span class="sc">%*%</span>XX[i,,]</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>      mat1 <span class="ot">&lt;-</span> mat1<span class="sc">+</span><span class="fu">t</span>(D)<span class="sc">%*%</span><span class="fu">ginv</span>(V)<span class="sc">%*%</span>D</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>      mat2 <span class="ot">&lt;-</span> mat2<span class="sc">+</span><span class="fu">t</span>(D)<span class="sc">%*%</span><span class="fu">ginv</span>(V)<span class="sc">%*%</span>S</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>    }</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>    <span class="co">#牛顿法求解</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>    hB <span class="ot">&lt;-</span> hB<span class="sc">+</span><span class="fu">as.vector</span>( <span class="fu">ginv</span>(mat1)<span class="sc">%*%</span>mat2 )</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>    dd <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">abs</span>(hB<span class="sc">-</span>hB0) ) <span class="sc">/</span> <span class="fu">sum</span>( <span class="fu">abs</span>(hB0)<span class="sc">+</span><span class="fl">0.0001</span> )</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>    <span class="cf">if</span>( dd<span class="sc">&lt;</span>ep ){ <span class="cf">break</span> }</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>  }</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>  <span class="fu">return</span>(hB)</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## &lt;srcref: file &quot;&quot; chars 1:1 to 34:1&gt;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">#example</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">GEE</span>(Y0,X0,tR)</span></code></pre></div>
<pre><code>## [1]  0.9684963 -2.0819982  1.0448573</code></pre>
</div>
<div id="gee_el" class="section level3">
<h3>GEE_EL</h3>
<p>Estimates of regression coefficients are obtained by maximizing the
empirical likelihood ratio</p>
<p>Input:</p>
<p>-y Response Variables (Matrix) -x Independent variables
(3-dimensional arrays) -cor Designated the type of working
correlation;Optional types are:ID、EC、AR、ST -init.beta initial value
of iteration (vector) -maxit Maximum number of iteration (int)</p>
<p>Output:final coefficient estimates and negative logarithmic value of
the empirical likelihood ratio</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="cf">function</span>(y, x, <span class="at">cor =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">init.beta =</span> <span class="cn">NULL</span>, <span class="at">maxit =</span> <span class="dv">1000</span>) {</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">3</span>]</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="co"># cor == &quot;ID&quot;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="cf">if</span> (cor <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>) {</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    elr_id <span class="ot">&lt;-</span>  <span class="cf">function</span>(b) {  <span class="co">#b输入为列向量</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>      m <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">3</span>]</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">1</span>]    <span class="co">#注意x,y来源</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>      t <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>      g <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, m)  <span class="co">#n对应i的个数，m对应b的维度3</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    <span class="co">#求解经验似然比</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>      error <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,t,n)</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>      D <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="fu">c</span>(t,<span class="dv">3</span>,n))</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="fu">c</span>(t,t,n))</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>        fitted <span class="ot">&lt;-</span> <span class="fu">plogis</span>( x[i,,] <span class="sc">%*%</span> b )</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>        error[,i] <span class="ot">&lt;-</span> y[i,]<span class="sc">-</span>fitted</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>        D[,,i] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(fitted<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>fitted),<span class="dv">3</span>),t,<span class="dv">3</span>)<span class="sc">*</span>x[i,,]</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>        A[,,i] <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>((fitted<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>fitted))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>      }</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>        A.half <span class="ot">&lt;-</span> A[,,i]<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>        g[i,] <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(D[,,i], A.half <span class="sc">%*%</span> A.half <span class="sc">%*%</span> error[,i])</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>      }</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>      g.mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, m)</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>      <span class="fu">el.test</span>(g, g.mu, <span class="at">gradtol =</span> <span class="fl">1e-9</span>)<span class="sc">$</span><span class="st">&quot;-2LLR&quot;</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>    }</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(init.beta)){ hB <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,m) }</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>    <span class="cf">else</span>{ hB <span class="ot">&lt;-</span> init.beta }</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>    <span class="co">#极大化经验似然比</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> hB, <span class="at">fn =</span> elr_id, <span class="at">method =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> maxit))</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">coff=</span>result<span class="sc">$</span>par,<span class="at">value=</span>result<span class="sc">$</span>value))</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>  }</span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>  <span class="co"># cor == &quot;EC&quot;</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>  <span class="cf">if</span> (cor <span class="sc">==</span> <span class="st">&quot;EC&quot;</span>) {</span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>    elr_ec <span class="ot">&lt;-</span> <span class="cf">function</span>(b) {  <span class="co"># b输入为列向量</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>      m <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">3</span>]</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">1</span>]  <span class="co"># 注意x,y格式</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>      t <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>      <span class="co"># n对应i的个数，m对应b的维度3</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>      g <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, m)</span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>      theta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, t)</span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a>        theta[i, ] <span class="ot">&lt;-</span> x[i, , ] <span class="sc">%*%</span> b</span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>      }</span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a>      <span class="co">#求解参数alpha，得到EC结构阵：R</span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a>      e <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, t)</span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a>      e <span class="ot">&lt;-</span> (y <span class="sc">-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>theta))) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">+</span> <span class="fu">exp</span>(theta) <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>theta)))</span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a>      alpha <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>t) {</span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a>          <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>t) {</span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a>            <span class="cf">if</span> (k <span class="sc">!=</span> j) alpha <span class="ot">&lt;-</span> alpha <span class="sc">+</span> e[i, j] <span class="sc">*</span> e[i, k]</span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a>          }</span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a>        }</span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a>      }</span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a>      alpha <span class="ot">&lt;-</span> alpha <span class="sc">/</span> (n<span class="sc">*</span>t<span class="sc">*</span>(t<span class="dv">-1</span>)<span class="sc">-</span>m)  <span class="co"># 矩估计由b求alpha</span></span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a>      alpha <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fl">0.95</span>, alpha)</span>
<span id="cb9-58"><a href="#cb9-58" tabindex="-1"></a>      alpha <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, alpha)</span>
<span id="cb9-59"><a href="#cb9-59" tabindex="-1"></a>      R <span class="ot">&lt;-</span> <span class="fu">exchCpp</span>(t, alpha)</span>
<span id="cb9-60"><a href="#cb9-60" tabindex="-1"></a>      <span class="co">#求解经验似然比</span></span>
<span id="cb9-61"><a href="#cb9-61" tabindex="-1"></a>      error <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, t, n)</span>
<span id="cb9-62"><a href="#cb9-62" tabindex="-1"></a>      D <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="fu">c</span>(t, <span class="dv">3</span>, n))</span>
<span id="cb9-63"><a href="#cb9-63" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="fu">c</span>(t, t, n))</span>
<span id="cb9-64"><a href="#cb9-64" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-65"><a href="#cb9-65" tabindex="-1"></a>        fitted <span class="ot">&lt;-</span> <span class="fu">plogis</span>(x[i, , ] <span class="sc">%*%</span> b)</span>
<span id="cb9-66"><a href="#cb9-66" tabindex="-1"></a>        error[, i] <span class="ot">&lt;-</span> y[i, ] <span class="sc">-</span> fitted</span>
<span id="cb9-67"><a href="#cb9-67" tabindex="-1"></a>        D[, , i] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(fitted <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> fitted), <span class="dv">3</span>), t, <span class="dv">3</span>) <span class="sc">*</span> x[i, , ]</span>
<span id="cb9-68"><a href="#cb9-68" tabindex="-1"></a>        A[, , i] <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>((fitted <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> fitted))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb9-69"><a href="#cb9-69" tabindex="-1"></a>      }</span>
<span id="cb9-70"><a href="#cb9-70" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-71"><a href="#cb9-71" tabindex="-1"></a>        A.half <span class="ot">&lt;-</span> A[, , i]<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb9-72"><a href="#cb9-72" tabindex="-1"></a>        g[i, ] <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(D[, , i], A.half <span class="sc">%*%</span> <span class="fu">solve</span>(R, A.half <span class="sc">%*%</span> error[, i]))</span>
<span id="cb9-73"><a href="#cb9-73" tabindex="-1"></a>      }</span>
<span id="cb9-74"><a href="#cb9-74" tabindex="-1"></a></span>
<span id="cb9-75"><a href="#cb9-75" tabindex="-1"></a>      g.mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, m)</span>
<span id="cb9-76"><a href="#cb9-76" tabindex="-1"></a>      <span class="fu">el.test</span>(g, g.mu, <span class="at">gradtol =</span> <span class="fl">1e-9</span>)<span class="sc">$</span><span class="st">&quot;-2LLR&quot;</span></span>
<span id="cb9-77"><a href="#cb9-77" tabindex="-1"></a>    }</span>
<span id="cb9-78"><a href="#cb9-78" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(init.beta)){ hB <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m) }</span>
<span id="cb9-79"><a href="#cb9-79" tabindex="-1"></a>    <span class="cf">else</span>{ hB <span class="ot">&lt;-</span> init.beta }</span>
<span id="cb9-80"><a href="#cb9-80" tabindex="-1"></a>    <span class="co">#极大化经验似然比</span></span>
<span id="cb9-81"><a href="#cb9-81" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> hB, <span class="at">fn =</span> elr_ec, <span class="at">method =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> maxit))</span>
<span id="cb9-82"><a href="#cb9-82" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">coff=</span>result<span class="sc">$</span>par,<span class="at">value=</span>result<span class="sc">$</span>value))</span>
<span id="cb9-83"><a href="#cb9-83" tabindex="-1"></a>  }</span>
<span id="cb9-84"><a href="#cb9-84" tabindex="-1"></a>  <span class="co"># cor == &quot;AR&quot;</span></span>
<span id="cb9-85"><a href="#cb9-85" tabindex="-1"></a>  <span class="cf">if</span> (cor <span class="sc">==</span> <span class="st">&quot;AR&quot;</span>) {</span>
<span id="cb9-86"><a href="#cb9-86" tabindex="-1"></a>    elr_ar <span class="ot">&lt;-</span> <span class="cf">function</span>(b) {  <span class="co"># b输入为列向量</span></span>
<span id="cb9-87"><a href="#cb9-87" tabindex="-1"></a>      m <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">3</span>]</span>
<span id="cb9-88"><a href="#cb9-88" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">1</span>]    <span class="co">#注意x,y来源</span></span>
<span id="cb9-89"><a href="#cb9-89" tabindex="-1"></a>      t <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]</span>
<span id="cb9-90"><a href="#cb9-90" tabindex="-1"></a>      <span class="co">#n对应i的个数，m对应b的维度3</span></span>
<span id="cb9-91"><a href="#cb9-91" tabindex="-1"></a>      g <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, m)</span>
<span id="cb9-92"><a href="#cb9-92" tabindex="-1"></a>      theta<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,n,t)</span>
<span id="cb9-93"><a href="#cb9-93" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-94"><a href="#cb9-94" tabindex="-1"></a>        theta[i, ] <span class="ot">&lt;-</span> x[i,,] <span class="sc">%*%</span> b</span>
<span id="cb9-95"><a href="#cb9-95" tabindex="-1"></a>      }</span>
<span id="cb9-96"><a href="#cb9-96" tabindex="-1"></a>      e<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,n,t)</span>
<span id="cb9-97"><a href="#cb9-97" tabindex="-1"></a>      e <span class="ot">&lt;-</span> (y <span class="sc">-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>theta))) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">+</span> <span class="fu">exp</span>(theta) <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>theta)))</span>
<span id="cb9-98"><a href="#cb9-98" tabindex="-1"></a>      <span class="co">#求解参数alpha，得到AR结构阵：R</span></span>
<span id="cb9-99"><a href="#cb9-99" tabindex="-1"></a>      alpha<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb9-100"><a href="#cb9-100" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-101"><a href="#cb9-101" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(t<span class="dv">-1</span>)) {</span>
<span id="cb9-102"><a href="#cb9-102" tabindex="-1"></a>          alpha<span class="ot">&lt;-</span>alpha<span class="sc">+</span>e[i,j]<span class="sc">*</span>e[i,j<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb9-103"><a href="#cb9-103" tabindex="-1"></a>        }}</span>
<span id="cb9-104"><a href="#cb9-104" tabindex="-1"></a>      alpha<span class="ot">&lt;-</span>alpha<span class="sc">/</span>((n<span class="sc">*</span>(t<span class="dv">-1</span>)<span class="sc">-</span>m))  <span class="co">#矩估计由b求alpha</span></span>
<span id="cb9-105"><a href="#cb9-105" tabindex="-1"></a>      alpha <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fl">0.95</span>, alpha)</span>
<span id="cb9-106"><a href="#cb9-106" tabindex="-1"></a>      alpha <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, alpha)</span>
<span id="cb9-107"><a href="#cb9-107" tabindex="-1"></a>      R<span class="ot">&lt;-</span><span class="fu">ar1Cpp</span>(t,alpha)</span>
<span id="cb9-108"><a href="#cb9-108" tabindex="-1"></a>      <span class="co">#经验似然比</span></span>
<span id="cb9-109"><a href="#cb9-109" tabindex="-1"></a>      error <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,t,n)</span>
<span id="cb9-110"><a href="#cb9-110" tabindex="-1"></a>      D <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="fu">c</span>(t,<span class="dv">3</span>,n))</span>
<span id="cb9-111"><a href="#cb9-111" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="fu">c</span>(t,t,n))</span>
<span id="cb9-112"><a href="#cb9-112" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-113"><a href="#cb9-113" tabindex="-1"></a>        fitted <span class="ot">&lt;-</span> <span class="fu">plogis</span>( x[i,,] <span class="sc">%*%</span> b )</span>
<span id="cb9-114"><a href="#cb9-114" tabindex="-1"></a>        error[,i] <span class="ot">&lt;-</span> y[i,]<span class="sc">-</span>fitted</span>
<span id="cb9-115"><a href="#cb9-115" tabindex="-1"></a>        D[,,i] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(fitted<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>fitted),<span class="dv">3</span>),t,<span class="dv">3</span>)<span class="sc">*</span>x[i,,]</span>
<span id="cb9-116"><a href="#cb9-116" tabindex="-1"></a>        A[,,i] <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>((fitted<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>fitted))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb9-117"><a href="#cb9-117" tabindex="-1"></a>      }</span>
<span id="cb9-118"><a href="#cb9-118" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-119"><a href="#cb9-119" tabindex="-1"></a>        A.half <span class="ot">&lt;-</span> A[,,i]<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb9-120"><a href="#cb9-120" tabindex="-1"></a>        g[i,] <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(D[,,i], A.half <span class="sc">%*%</span> <span class="fu">solve</span>(R, A.half <span class="sc">%*%</span> error[,i]))</span>
<span id="cb9-121"><a href="#cb9-121" tabindex="-1"></a>      }</span>
<span id="cb9-122"><a href="#cb9-122" tabindex="-1"></a>      g.mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, m)</span>
<span id="cb9-123"><a href="#cb9-123" tabindex="-1"></a>      <span class="fu">el.test</span>(g, g.mu, <span class="at">gradtol =</span> <span class="fl">1e-9</span>)<span class="sc">$</span><span class="st">&quot;-2LLR&quot;</span></span>
<span id="cb9-124"><a href="#cb9-124" tabindex="-1"></a>    }</span>
<span id="cb9-125"><a href="#cb9-125" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(init.beta)){ hB <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m) }</span>
<span id="cb9-126"><a href="#cb9-126" tabindex="-1"></a>    <span class="cf">else</span>{ hB <span class="ot">&lt;-</span> init.beta }</span>
<span id="cb9-127"><a href="#cb9-127" tabindex="-1"></a>    <span class="co">#极大化经验似然比得到所需参数估计</span></span>
<span id="cb9-128"><a href="#cb9-128" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> hB, <span class="at">fn =</span> elr_ar, <span class="at">method =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> maxit))</span>
<span id="cb9-129"><a href="#cb9-129" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">coff=</span>result<span class="sc">$</span>par,<span class="at">value=</span>result<span class="sc">$</span>value))</span>
<span id="cb9-130"><a href="#cb9-130" tabindex="-1"></a>  }</span>
<span id="cb9-131"><a href="#cb9-131" tabindex="-1"></a>  <span class="co"># cor == &quot;ST&quot;</span></span>
<span id="cb9-132"><a href="#cb9-132" tabindex="-1"></a>  <span class="cf">if</span> (cor <span class="sc">==</span> <span class="st">&quot;ST&quot;</span>) {</span>
<span id="cb9-133"><a href="#cb9-133" tabindex="-1"></a>    elr_st <span class="ot">&lt;-</span> <span class="cf">function</span>(b) {  <span class="co"># b输入为列向量</span></span>
<span id="cb9-134"><a href="#cb9-134" tabindex="-1"></a>      m <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">3</span>]</span>
<span id="cb9-135"><a href="#cb9-135" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">1</span>]    <span class="co">#注意x,y来源</span></span>
<span id="cb9-136"><a href="#cb9-136" tabindex="-1"></a>      t <span class="ot">&lt;-</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]</span>
<span id="cb9-137"><a href="#cb9-137" tabindex="-1"></a>      g <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, m)  <span class="co">#n对应i的个数，m对应b的维度3</span></span>
<span id="cb9-138"><a href="#cb9-138" tabindex="-1"></a></span>
<span id="cb9-139"><a href="#cb9-139" tabindex="-1"></a>      theta<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,n,t)</span>
<span id="cb9-140"><a href="#cb9-140" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-141"><a href="#cb9-141" tabindex="-1"></a>        theta[i, ] <span class="ot">&lt;-</span> x[i,,] <span class="sc">%*%</span> b</span>
<span id="cb9-142"><a href="#cb9-142" tabindex="-1"></a>      }</span>
<span id="cb9-143"><a href="#cb9-143" tabindex="-1"></a>      e<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="dv">0</span>,n,t)</span>
<span id="cb9-144"><a href="#cb9-144" tabindex="-1"></a>      e <span class="ot">&lt;-</span> (y <span class="sc">-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>theta))) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">+</span> <span class="fu">exp</span>(theta) <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>theta)))</span>
<span id="cb9-145"><a href="#cb9-145" tabindex="-1"></a>      <span class="co"># 求解ST矩阵的参数向量alpha</span></span>
<span id="cb9-146"><a href="#cb9-146" tabindex="-1"></a>      alpha<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">0</span>,t<span class="dv">-1</span>)</span>
<span id="cb9-147"><a href="#cb9-147" tabindex="-1"></a>      <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(t<span class="dv">-1</span>)){</span>
<span id="cb9-148"><a href="#cb9-148" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-149"><a href="#cb9-149" tabindex="-1"></a>          <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(t<span class="sc">-</span>k)) {</span>
<span id="cb9-150"><a href="#cb9-150" tabindex="-1"></a>            alpha[k]<span class="ot">&lt;-</span>alpha[k]<span class="sc">+</span>e[i,j]<span class="sc">*</span>e[i,j<span class="sc">+</span>k]</span>
<span id="cb9-151"><a href="#cb9-151" tabindex="-1"></a>          }}</span>
<span id="cb9-152"><a href="#cb9-152" tabindex="-1"></a>        alpha[k]<span class="ot">&lt;-</span>alpha[k]<span class="sc">/</span>((n<span class="sc">*</span>(t<span class="sc">-</span>k)<span class="sc">-</span>m))  <span class="co">#矩估计由b求alpha</span></span>
<span id="cb9-153"><a href="#cb9-153" tabindex="-1"></a>        alpha[k] <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fl">0.95</span>, alpha[k])</span>
<span id="cb9-154"><a href="#cb9-154" tabindex="-1"></a>        alpha[k] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, alpha[k])</span>
<span id="cb9-155"><a href="#cb9-155" tabindex="-1"></a>      }</span>
<span id="cb9-156"><a href="#cb9-156" tabindex="-1"></a>      <span class="co">#得到对应ST结构阵</span></span>
<span id="cb9-157"><a href="#cb9-157" tabindex="-1"></a>      R<span class="ot">&lt;-</span><span class="fu">statCpp</span>(t,alpha)</span>
<span id="cb9-158"><a href="#cb9-158" tabindex="-1"></a>      <span class="co">#求解经验似然比</span></span>
<span id="cb9-159"><a href="#cb9-159" tabindex="-1"></a>      error <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,t,n)</span>
<span id="cb9-160"><a href="#cb9-160" tabindex="-1"></a>      D <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="fu">c</span>(t,<span class="dv">3</span>,n))</span>
<span id="cb9-161"><a href="#cb9-161" tabindex="-1"></a>      A <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="fu">c</span>(t,t,n))</span>
<span id="cb9-162"><a href="#cb9-162" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-163"><a href="#cb9-163" tabindex="-1"></a>        fitted <span class="ot">&lt;-</span> <span class="fu">logit</span>(<span class="fu">as.vector</span>(x[i,,] <span class="sc">%*%</span> b))</span>
<span id="cb9-164"><a href="#cb9-164" tabindex="-1"></a>        error[,i] <span class="ot">&lt;-</span> y[i,]<span class="sc">-</span>fitted</span>
<span id="cb9-165"><a href="#cb9-165" tabindex="-1"></a>        D[,,i] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(fitted<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>fitted),<span class="dv">3</span>),t,<span class="dv">3</span>)<span class="sc">*</span>x[i,,]</span>
<span id="cb9-166"><a href="#cb9-166" tabindex="-1"></a>        A[,,i] <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>((fitted<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>fitted))<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb9-167"><a href="#cb9-167" tabindex="-1"></a>      }</span>
<span id="cb9-168"><a href="#cb9-168" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb9-169"><a href="#cb9-169" tabindex="-1"></a>        A.half <span class="ot">&lt;-</span> A[,,i]<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb9-170"><a href="#cb9-170" tabindex="-1"></a>        g[i,] <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(D[,,i], A.half <span class="sc">%*%</span> <span class="fu">solve</span>(R, A.half <span class="sc">%*%</span> error[,i]))</span>
<span id="cb9-171"><a href="#cb9-171" tabindex="-1"></a>      }</span>
<span id="cb9-172"><a href="#cb9-172" tabindex="-1"></a>      g.mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, m)</span>
<span id="cb9-173"><a href="#cb9-173" tabindex="-1"></a>      <span class="fu">el.test</span>(g, g.mu, <span class="at">gradtol =</span> <span class="fl">1e-9</span>)<span class="sc">$</span><span class="st">&quot;-2LLR&quot;</span></span>
<span id="cb9-174"><a href="#cb9-174" tabindex="-1"></a>    }</span>
<span id="cb9-175"><a href="#cb9-175" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(init.beta)){ hB <span class="ot">&lt;-</span> <span class="fu">numeric</span>(m) }</span>
<span id="cb9-176"><a href="#cb9-176" tabindex="-1"></a>    <span class="cf">else</span>{ hB <span class="ot">&lt;-</span> init.beta }</span>
<span id="cb9-177"><a href="#cb9-177" tabindex="-1"></a>    <span class="co">#极大化经验似然比</span></span>
<span id="cb9-178"><a href="#cb9-178" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">par =</span> hB, <span class="at">fn =</span> elr_st, <span class="at">method =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> maxit))</span>
<span id="cb9-179"><a href="#cb9-179" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">coff=</span>result<span class="sc">$</span>par,<span class="at">value=</span>result<span class="sc">$</span>value))</span>
<span id="cb9-180"><a href="#cb9-180" tabindex="-1"></a>  }</span>
<span id="cb9-181"><a href="#cb9-181" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## &lt;srcref: file &quot;&quot; chars 1:1 to 181:1&gt;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co">#example</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">GEE_EL</span>(Y0,X0,<span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<pre><code>## $coff
## [1]  0.9781175 -2.1351499  1.1233485
## 
## $value
## [1] 1.892632e-05</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">GEE_EL</span>(Y0,X0,<span class="st">&quot;EC&quot;</span>)</span></code></pre></div>
<pre><code>## $coff
## [1]  0.9700881 -2.0962479  1.0665491
## 
## $value
## [1] 3.608523e-05</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">GEE_EL</span>(Y0,X0,<span class="st">&quot;AR&quot;</span>)</span></code></pre></div>
<pre><code>## $coff
## [1]  0.9756771 -2.1016090  1.0816082
## 
## $value
## [1] 3.775546e-05</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">GEE_EL</span>(Y0,X0,<span class="st">&quot;ST&quot;</span>)</span></code></pre></div>
<pre><code>## $coff
## [1]  0.9663095 -2.0722156  1.0291519
## 
## $value
## [1] 1.280922e-05</code></pre>
</div>
<div id="other-functions" class="section level3">
<h3>other functions</h3>
<div id="cpp-function" class="section level4">
<h4>cpp function</h4>
<p>generate EC, AR, ST working correlation matrix:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>NumericMatrix <span class="fu">exchCpp</span>(int t, double alpha) {</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  NumericMatrix <span class="fu">exch</span>(t, t);</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> 初始化对角线元素为1</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="cf">for</span> (int <span class="at">i =</span> <span class="dv">0</span>; i <span class="sc">&lt;</span> t; <span class="sc">++</span>i) {</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    <span class="fu">exch</span>(i, i) <span class="ot">=</span> <span class="fl">1.0</span>;</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  }</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> 设置非对角线元素为alpha</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  <span class="cf">for</span> (int <span class="at">i =</span> <span class="dv">0</span>; i <span class="sc">&lt;</span> t; <span class="sc">++</span>i) {</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>    <span class="cf">for</span> (int <span class="at">j =</span> <span class="dv">0</span>; j <span class="sc">&lt;</span> t; <span class="sc">++</span>j) {</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="sc">!=</span> j) {</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>        <span class="fu">exch</span>(i, j) <span class="ot">=</span> alpha;</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>      }</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>    }</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>  }</span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>  return exch;</span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>NumericMatrix <span class="fu">ar1Cpp</span>(int t, double alpha) {</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>   NumericMatrix <span class="fu">ar1</span>(t, t);</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>   <span class="cf">for</span>(int <span class="at">i =</span> <span class="dv">0</span>; i <span class="sc">&lt;</span> t; <span class="sc">++</span>i) {</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>     <span class="cf">for</span>(int <span class="at">j =</span> i; j <span class="sc">&lt;</span> t; <span class="sc">++</span>j) {</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>       <span class="cf">if</span>(i <span class="sc">==</span> j) {</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>         <span class="fu">ar1</span>(i, j) <span class="ot">=</span> <span class="dv">1</span>;</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>       } <span class="cf">else</span> {</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>         <span class="fu">ar1</span>(i, j) <span class="ot">=</span> <span class="fu">pow</span>(alpha, j <span class="sc">-</span> i);</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>         <span class="fu">ar1</span>(j, i) <span class="ot">=</span> <span class="fu">ar1</span>(i, j);</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>       }</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>     }</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>   }</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>   return ar1;</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a> }</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>NumericMatrix <span class="fu">statCpp</span>(int t, NumericVector a) {</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  int m <span class="ot">=</span> <span class="fu">a.size</span>();</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  NumericMatrix <span class="fu">stat</span>(t, t);</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> 设置对角线元素为1</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="cf">for</span>(int <span class="at">i =</span> <span class="dv">0</span>; i <span class="sc">&lt;</span> t; <span class="sc">++</span>i) {</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    <span class="fu">stat</span>(i, i) <span class="ot">=</span> <span class="dv">1</span>;</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  }</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> 设置非对角线元素</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>  <span class="cf">for</span>(int <span class="at">i =</span> <span class="dv">0</span>; i <span class="sc">&lt;</span> t; <span class="sc">++</span>i) {</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>    <span class="cf">for</span>(int <span class="at">j =</span> <span class="dv">0</span>; j <span class="sc">&lt;</span> t; <span class="sc">++</span>j) {</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">abs</span>(i <span class="sc">-</span> j) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">abs</span>(i <span class="sc">-</span> j) <span class="sc">&lt;=</span> m) {</span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a>        <span class="fu">stat</span>(i, j) <span class="ot">=</span> a[<span class="fu">abs</span>(i <span class="sc">-</span> j) <span class="sc">-</span> <span class="dv">1</span>];</span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>      }</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>    }</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>  }</span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>  return stat;</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="logit-function" class="section level4">
<h4>logit function</h4>
<p>Convert real numbers to numbers between (0,1) using logistic
functions</p>
<p>Input: x independent variable (Matrix) Output: the value of the
logistic function corresponding to x</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="cf">function</span>(x){</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="co">#计算logistic函数，允许x为数值，向量或矩阵</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>x))}</span></code></pre></div>
<pre><code>## &lt;srcref: file &quot;&quot; chars 1:1 to 3:16&gt;</code></pre>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
